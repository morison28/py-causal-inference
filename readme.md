- 因果推論 - 基礎から機械学習・時系列分析・因果探索を用いた意思決定のアプローチ
- コードは[こちら](https://note.com/tak1/n/n8fa31d4c8038)から引用

## tmp: 因果推論周りの知識をメモ



## 1. 因果の探求から社会実装

- 因果を含む真理を追求するための科学的アプローチには3段階がある
    - ブラーエ(データ収集)
    - ケプラー(法則化)
    - ニュートン(真理発見)
- 意思決定フロー(因果推論を行う場合の本書におけるフロー)

![alt text](./images/ch01/image.png)


## 2. 因果推論の基礎

- 因果推論を考える上で基本的な概念について，全体像を通して把握する

- 因果の三原則
    - 原因と結果は時空間的に隣接している
        - → 交絡因子(原因と結果の両方に影響する因子)が存在しない
    - 原因は結果に時間的に先行している
        - → 上記の通り，原因が先行する
    - 原因と結果は常につながっている
        - → 原因と結果には相関関係がある

- 因果関係を特定するには？
    - プロセスやメカニズムと統計的関連性から考える必要がある

### ランダム化比較実験とは

- あるべき検証方法：理想的にはRCTであるが，あらゆる制約があり実施不可能であることが大半
    - レベル1
        - 処置群の前後比較，または処置群と対照群の処置後の1時点データのみを使用した分析(変数調整なし)
    - レベル2
        - レベル1において変数調整を行った分析
        - **これが回帰分析とか傾向スコア？**
    - レベル3
        - 処置群と対照群それぞれの処置前後のデータを使用した分析(DiDなど)
    - レベル4
        - 実験に類似する状況を利用した，回帰不連続デザインや操作変数法による分析
    - レベル5
        - 処置群と対照群のランダム割り当てによる分析(RCT)
### 因果推論

- 因果推論とは
    - ある事象が「なぜ」起こるのか？という問いに対してデータを用いて答えを推論する考え方
- 本書における因果推論
    - 観察された因果関係における因果効果はどれほどか(因果効果の推定)
    - 観察対象のプロセスやメカニズムの因果構造はどのようになっているか(因果探索)

### 因果効果

- 因果推論の重要な仮定：識別仮定(識別性条件+SUTVA)
    - 識別性条件 : 観測データから母数が一意に推定できる
    - SUTVA : Stable Unit Treatment Value Assumption .. 処置を受ける個体について処置の効果が安定している
    - 識別性条件
        - ① : 独立性
            - 処置群を入れ替えてもアウトカムの期待値は一緒
            - 回帰分析とか傾向スコアとかでやっていることは独立性を成立させるための操作だと理解している
        - ② : 正値性
            - 各処置に割り当てられる確率が0ではない
    - SUTVA
        - ③ : 相互作用なし
            - 潜在結果変数が他の個体の処置状態に依存しない
        - ④ : 一致性
            - 処置の結果が潜在的な結果と一致

### 因果効果推定のためのグラフ

- `chap2_Ylearn.ipynb`にてコードを動かしてみる

- DAG(Directed Acyclic Graph) : 有向非巡回グラフ
    - DAGを使えば，独立性は数値計算(変数間の相関など)で判定するのではなく，グラフの形から判断することができる
    - グラフの形がd分離であれば，独立性を判定できる

- d分離(d-separation)の条件は以下2つの**いずれか**
    - DAGの中でXとYを結ぶ任意の経路において，合流点Zやその子孫が集合Sに含まれていない
    - XとYを結ぶ経路が連鎖経路や分岐経路であり，その中間ノードZやが集合Sにに含まれる
